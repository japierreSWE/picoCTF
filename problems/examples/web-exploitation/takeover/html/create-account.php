<?php

  include "cnfg.php";
  $con = new SQLite3($database_file);

  $username = $_POST["user"];
  $password = $_POST["pass"];
  $type = $_POST["accountType"];

  if (strpos($username, '=') > -1 or strpos($password, '=') > -1 or strpos($password, "'") > -1 or strpos($password, "'") > -1){
    echo "Sorry, invalid username or password";
  }else{

    $tableThere = "SELECT name FROM sqlite_master WHERE name='users'";
    $tresult = $con->query($tableThere);
    $trow = $tresult->fetchArray();

    if (!$trow){
      $con->exec("CREATE TABLE users (name text, password text, type integer)");
    }

    if ($type == "consumer"){
      $query = "INSERT INTO users(name, password, type) VALUES ('$username', '$password', 1)";
    }elseif($type == "business"){
      $query = "INSERT INTO users(name, password, type) VALUES ('$username', '$password', 2)";
    }elseif($type == "webmaster"){
      $query = "INSERT INTO users(name, password, type) VALUES ('$username', '$password', 3)";
    }
    
    if ($con->exec($query)){
      echo "Account created!";
    }else{
      echo "Sorry, couldn't create an account";
    }

    
    
  }
?>
